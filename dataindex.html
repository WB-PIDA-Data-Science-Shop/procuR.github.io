<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Public Procurement Data Dictionary</title>

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">

  <!-- jQuery + DataTables JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 20px;
    }
    h1 {
      margin-bottom: 10px;
    }
    #tabs {
      margin-bottom: 15px;
    }
    .tab-button {
      display: inline-block;
      padding: 8px 14px;
      margin-right: 6px;
      margin-bottom: 6px;
      border-radius: 4px;
      border: 1px solid #ccc;
      cursor: pointer;
      background: #f5f5f5;
      font-size: 14px;
    }
    .tab-button.active {
      background: #e0e0ff;
      border-color: #777;
      font-weight: 600;
    }

    /* We hide/show the whole DataTables wrapper (table + controls) */
    .sheet-wrapper {
      display: none;
    }
    .sheet-wrapper.active {
      display: block;
    }
  </style>
</head>
<body>
  <section>
  <h2>Public Procurement Data Dictionary</h2>
  <p>
    The <strong>Public Procurement Data Dictionary</strong> includes the following components:
  </p>
  <ul>
    <li>
      <strong>flattened_csv</strong> – a consolidated version of all data fields merged into a single CSV file. 
      This file can be used to perform comprehensive analyses.
    </li>
    <li>
      <strong>tender</strong> – variables related to the tender level, including basic information such as 
      the announcement date, procedure type, and source URL.
    </li>
    <li>
      <strong>lot</strong> – all variables describing the lot level. 
      By default, this serves as the primary unit of observation in the <code>flattened_csv</code>, 
      with each lot corresponding to a contract.
    </li>
    <li>
      <strong>bid</strong> – information on all bidders, including details about winning and losing bids. 
      When filtering to include only winning bids in the <code>flattened_csv</code>, the dataset represents 
      a contract-level observation, where the winning bid equals the contract price and bidder attributes 
      describe the supplier.
    </li>
    <li>
      <strong>buyer</strong> – variables describing the procuring agency responsible for the tender.
    </li>
    <li>
      <strong>unit</strong> – fields providing more granular data on individual items within each lot, 
      when such detail is available. In countries where this level of granularity is reported, 
      items can serve as the unit of observation in the <code>flattened_csv</code>, though this 
      level of detail is not always present.
    </li>
    <li>
      <strong>amendment</strong> – data fields capturing any contract or tender modifications.
    </li>
    <li>
      <strong>funding</strong> – variables describing the source(s) of funding for a tender, where applicable.
    </li>
    <li>
  <strong>enumeration</strong> – an overview of categorical variables and their definitions. 
  Currently, it is largely based on categories used in 
  <a href="https://www.procurementintegrity.org/data" target="_blank" rel="noopener noreferrer">
    ProAct datasets</a>.
    </li>
  </ul>
  <p>
    Each tab contains a unique identifier (<code>id</code>) that enables merging across datasets, 
    depending on the appropriate level of observation. 
    For example, <em>items</em> should be merged by <em>tender</em> and <em>lot</em>, 
    while <em>buyers</em> only require the <em>tender_id</em>, 
    since each tender has a single procuring agency responsible for all its lots.
  </p>
  <p>
  You can also 
<a href="./public_procurement_dictionary.xlsx" download>
  download the full Excel file here</a>.
</p>

</section>
  <!-- Where sheet buttons will go -->
  <div id="tabs"></div>

  <!-- Where sheet tables will go (wrappers will be inserted here) -->
  <div id="tables"></div>

  <script>
    // Load JSON with all sheets
    fetch('./data.json')
      .then(response => response.json())
      .then(allSheets => {
        const tabsDiv = document.getElementById('tabs');
        const tablesDiv = document.getElementById('tables');

        let firstSheet = true;

        Object.keys(allSheets).forEach(sheetName => {
          const rows = allSheets[sheetName];
          if (!rows || rows.length === 0) return; // skip empty sheets

          // --- Create tab button ---
          const btn = document.createElement('button');
          btn.textContent = sheetName;
          btn.className = 'tab-button';
          btn.dataset.target = 'table_' + sheetName.replace(/\W+/g, '_');
          tabsDiv.appendChild(btn);

          // --- Create table element ---
          const tableId = btn.dataset.target;
          const table = document.createElement('table');
          table.id = tableId;
          table.className = 'display';
          table.style.width = '100%';
          tablesDiv.appendChild(table);

          // Build header from keys of first row
          const headers = Object.keys(rows[0]);

          const thead = document.createElement('thead');
          const headerRow = document.createElement('tr');
          headers.forEach(h => {
            const th = document.createElement('th');
            th.textContent = h;
            headerRow.appendChild(th);
          });
          thead.appendChild(headerRow);
          table.appendChild(thead);

          const tbody = document.createElement('tbody');
          rows.forEach(r => {
            const tr = document.createElement('tr');
            headers.forEach(h => {
              const td = document.createElement('td');
              td.textContent = (r[h] !== null && r[h] !== undefined) ? r[h] : '';
              tr.appendChild(td);
            });
            tbody.appendChild(tr);
          });
          table.appendChild(tbody);

          // Initialize DataTables after it's in the DOM
          const dt = $(table).DataTable();

          // Get the DataTables "wrapper" div (contains table + controls)
          const wrapper = dt.table().container();
          wrapper.classList.add('sheet-wrapper');

          // Make first sheet active by default
          if (firstSheet) {
            btn.classList.add('active');
            wrapper.classList.add('active');
            firstSheet = false;
          }

          // Tab button click handler
          btn.addEventListener('click', () => {
            // Deactivate all tabs and wrappers
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.sheet-wrapper').forEach(w => w.classList.remove('active'));

            // Activate this one
            btn.classList.add('active');
            wrapper.classList.add('active');
          });
        });
      })
      .catch(err => {
        console.error('Error loading data.json:', err);
        alert('Could not load data.json. Make sure it is in the same folder as dataindex.html.');
      });
  </script>
</body>
</html>